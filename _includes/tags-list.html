<!-- See https://blog.lanyonm.org/articles/2013/11/21/alphabetize-jekyll-page-tags-pure-liquid.html -->
<!-- With added pipe to handle lack of sort_natural -->
{% capture site_tags %}{% for tags in site.tags %}{{ tags | first | downcase }}|{{ tags | first }}{% unless forloop.last %},{% endunless %}{% endfor %}{% endcapture %}
<!-- site_tags: {{ site_tags }} -->
{% assign tags_words = site_tags | split:',' | sort %}
<!-- tags_words: {{ tags_words }} -->

<div id="tags-page">
  <div class="tags-list" style="padding-left:1.6em">
    {% for tags_pair in tags_words %}
    {% assign tags = tags_pair | split:'|' | last %}
    <a href="{{ site.baseurl | append: post.url }}/tags#{{ tags | slugify }}" class="tags-link" style="padding-left:1em>
      <span class="tags-name">{{ tags }}</span>
      <span class="tags-count">[{{ site.tags[tags] | size }}]</span>
    </a>,
    {% endfor %}
  </div>

 <br>

  <div class="posts-by-tags">
    {% for tags_pair in tags_words %}
    {% assign tags = tags_pair | split:'|' | last %}
    <div id="{{ tags | slugify }}" class="posts-for-tags">
      <h4>{{ tags }}</h4>
      <ul class="posts-list">
        {% for post in site.tags[tags] %}
          <li>
              <a href="{{ post.url | relative_url }}" style="text-decoration:none;">
                {{ post.title }}&nbsp;
                [{% for tags in post.tags -%}
                   {% capture tags_name %}{{ tags }}{% endcapture %}
                   {{ tags_name }}
                {%- endfor %}

                {% for tags in post.tags -%}
                   {% capture tags_name %}{{ tags }}{% endcapture %}
                   {{ tags_name }}, 
                {%- endfor %}&nbsp;]
              </a>
          </li>
        {% endfor %}
      </ul>
    </div>
    {% endfor %}
  </div>
</div>
